<!DOCTYPE html>
<html lang="zh-cn">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="ä¸ºä»€ä¹ˆé€‰æ‹©Hookè€Œéâ€¦â€¦?"/><meta name="keywords" content="é™ˆé‘«è°±,xinpu,æ˜•æµ¦,xinpuchen,å‰ç«¯,frontend-notes,awesome-coding" /><link rel="alternate" href="/atom.xml" title="Xinpu's Blog"><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=2.11.0" />
<link rel="canonical" href="https://xinpuchen.github.io/Why-Isnâ€™t-X-a-Hook/"/>

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" /><script type="text/x-mathjax-config">
    MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.0" />

<script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":"","latex":true};
</script>

    <title>ä¸ºä»€ä¹ˆé€‰æ‹©Hookè€Œéâ€¦â€¦? - Xinpu's Blog</title>
  <meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Xinpu's Blog" type="application/atom+xml">
</head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Xinpu's Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/">
        <li class="mobile-menu-item">é¦–é¡µ
          </li>
      </a><a href="/archives/">
        <li class="mobile-menu-item">å½’æ¡£
          </li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">åˆ†ç±»
          </li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">æ ‡ç­¾
          </li>
      </a><a href="https://xinpuchen.top/frontend-notes/" target="_blank" rel="noopener">
        <li class="mobile-menu-item">å‰ç«¯ç¬”è®°
          </li>
      </a><a href="https://xinpuchen.top/awesome-coding/" target="_blank" rel="noopener">
        <li class="mobile-menu-item">ç®—æ³•ç»ƒä¹ 
          </li>
      </a><a href="/about/">
        <li class="mobile-menu-item">å…³äº
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Xinpu's Blog</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/">
            é¦–é¡µ
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            å½’æ¡£
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/categories/">
            åˆ†ç±»
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            æ ‡ç­¾
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="https://xinpuchen.top/frontend-notes/" target="_blank" rel="noopener">
            å‰ç«¯ç¬”è®°
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="https://xinpuchen.top/awesome-coding/" target="_blank" rel="noopener">
            ç®—æ³•ç»ƒä¹ 
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/about/">
            å…³äº
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><article class="post">
    <header class="post-header">
      <h1 class="post-title">ä¸ºä»€ä¹ˆé€‰æ‹©Hookè€Œéâ€¦â€¦?
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2019-02-10
        </span><span class="post-category">
            <a href="/categories/React/">React</a>
            </span>
        </div>
    </header>

    <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ä½¿ç”¨-Hookï¼šuseState"><span class="toc-text">ä½¿ç”¨ Hookï¼šuseState()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#æ„æˆ-Composition"><span class="toc-text">æ„æˆ Composition</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#è°ƒè¯•-Debugging"><span class="toc-text">è°ƒè¯• Debugging</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸åº”ä½¿ç”¨-Hookï¼šuseBailout"><span class="toc-text">ä¸åº”ä½¿ç”¨ Hookï¼šuseBailout()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#æ„æˆ-Composition-1"><span class="toc-text">æ„æˆ Composition</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#è°ƒè¯•-Debugging-1"><span class="toc-text">è°ƒè¯• Debugging</span></a></li></ol></li></ol>
    </div>
  </div><div class="post-content"><p>è‡ªä»ç¬¬ä¸€ä¸ªå…³äº<a href="https://reactjs.org/hooks" target="_blank" rel="noopener">React Hooks</a>çš„ alpha ç‰ˆæœ¬å‘å¸ƒä»¥æ¥ï¼Œæœ‰ä¸€ä¸ªé—®é¢˜ä¸æ–­å‡ºç°åœ¨è®¨è®ºä¸­ï¼šâ€œä¸ºä»€ä¹ˆæ˜¯ Hook è€Œé _&lt;ä¸€äº›å…¶ä»–çš„ API&gt;_ ï¼Ÿâ€</p>
<p>æç¤ºä¸€ä¸‹ï¼Œä»¥ä¸‹çš„è¿™äº›å°±<em>æ˜¯</em>Hooksï¼š</p>
<ul>
<li><a href="https://reactjs.org/docs/hooks-reference.html#usestate" target="_blank" rel="noopener"><code>useState()</code></a> ç”¨äºå£°æ˜ä¸€ä¸ªçŠ¶æ€å˜é‡ã€‚</li>
<li><a href="https://reactjs.org/docs/hooks-reference.html#useeffect" target="_blank" rel="noopener"><code>useEffect()</code></a> ç”¨äºå£°æ˜ä¸€ä¸ªè¡¥å……è§„åˆ™(side effect)ã€‚</li>
<li><a href="https://reactjs.org/docs/hooks-reference.html#usecontext" target="_blank" rel="noopener"><code>useContext()</code></a> ç”¨äºè¯»å–ä¸€äº›ä¸Šä¸‹æ–‡çš„å†…å®¹ã€‚</li>
</ul>
<a id="more"></a>

<p>ä½†æ˜¯ä»æœ‰ä¸€äº›å…¶ä»–çš„ APIï¼Œä¾‹å¦‚<code>React.memo()</code>å’Œ<code>&lt;Context.Provider&gt;</code>ï¼Œå®ƒä»¬<em>ä¸æ˜¯</em>Hooksã€‚é€šå¸¸æå‡ºçš„ Hook ç‰ˆæœ¬ä¼šå»ºè®®æ˜¯<em>noncompositional</em>æˆ–è€…<em>antimodular</em>ã€‚æœ¬æ–‡å°†å¸®åŠ©ä½ äº†è§£åŸå› ã€‚</p>
<p><strong>æç¤ºï¼šè¿™ç¯‡æ–‡ç« å¯¹é‚£äº›å¯¹ API è®¨è®ºæ„Ÿå…´è¶£çš„äººæ¥è¯´æ˜¯ä¸€ä¸ªæ·±åˆ»çš„è¯é¢˜ï¼Œä½ ä¸éœ€è¦è€ƒè™‘ä½¿ç”¨ React æ¥æå‡æ•ˆç‡ï¼</strong></p>
<hr>
<p>æˆ‘ä»¬å¸Œæœ› React API ä¿ç•™ä¸¤ä¸ªé‡è¦å±æ€§ï¼š</p>
<ol>
<li><strong>æ„æˆ Composition:</strong> <a href="https://reactjs.org/docs/hooks-custom.html" target="_blank" rel="noopener">å®šåˆ¶ Hooks</a>å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯æˆ‘ä»¬å¯¹ Hooks API æ„Ÿåˆ°å…´å¥‹çš„åŸå› ã€‚æˆ‘ä»¬å¸Œæœ›å¤§å®¶å¯ä»¥é¢‘ç¹çš„æ„å»ºè‡ªå·±çš„ Hooksï¼Œå¹¶ä¸”æˆ‘ä»¬éœ€è¦ä¿è¯ä¸åŒäººå†™çš„ Hooks<a href="https://overreacted.io/why-do-hooks-rely-on-call-order/#flaw-4-the-diamond-problem" target="_blank" rel="noopener">ä¸ä¼šå‘ç”Ÿå†²çª</a>ã€‚ï¼ˆæˆ‘ä»¬å¤§æ¦‚ä¼šè¢«ç¼–å†™æ¸…çˆ½ä¸”ä¸ä¼šç›¸äº’ç ´åçš„ç»„ä»¶è¿™æ ·çš„ä½“éªŒå® åå§ï¼ï¼‰</li>
<li><strong>è°ƒè¯• Debugging:</strong> æˆ‘ä»¬å¸Œæœ›éšç€ç¨‹åºçš„å¢é•¿ï¼ŒBugs<a href="/archives/algorithm/1549245751.html">å¾ˆå®¹æ˜“æ‰¾åˆ°</a>ã€‚React çš„æœ€ä½³ç‰¹å¾ä¹‹ä¸€å°±æ˜¯â€”â€”å¦‚æœä½ çœ‹åˆ°å‘ˆç°å‡ºäº†ä»»ä½•é”™è¯¯ï¼Œéƒ½èƒ½å¤Ÿé€šè¿‡ç»“æ„æ ‘æ‰¾åˆ°é‚£ä¸ªç»„ä»¶çš„ prop æˆ– state å¯¼è‡´çš„é”™è¯¯ã€‚</li>
</ol>
<p>è¿™ä¸¤ä¸ªçº¦æŸæ”¾åœ¨ä¸€èµ·å¯ä»¥å‘Šè¯‰æˆ‘ä»¬ä»€ä¹ˆå¯ä»¥æˆ–<em>ä¸å¯ä»¥</em>ä½¿ç”¨ Hookã€‚è®©æˆ‘ä»¬çœ‹å‡ ä¸ªä¾‹å­ã€‚</p>
<hr>
<h2 id="ä½¿ç”¨-Hookï¼šuseState"><a href="#ä½¿ç”¨-Hookï¼šuseState" class="headerlink" title="ä½¿ç”¨ Hookï¼šuseState()"></a>ä½¿ç”¨ Hookï¼š<code>useState()</code></h2><h3 id="æ„æˆ-Composition"><a href="#æ„æˆ-Composition" class="headerlink" title="æ„æˆ Composition"></a>æ„æˆ Composition</h3><p>æ¯ä¸ªè°ƒç”¨<code>useState()</code>çš„å¤šä¸ªè‡ªå®šä¹‰ Hook éƒ½ä¸ä¼šå†²çªï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useMyCustomHook1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="comment">// What happens here, stays here.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useMyCustomHook2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="comment">// What happens here, stays here.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  useMyCustomHook1();</span><br><span class="line">  useMyCustomHook2();</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ ä¸€ä¸ªæ–°çš„æ— æ¡ä»¶<code>useState()</code>è°ƒç”¨æ€»æ˜¯å®‰å…¨çš„ã€‚ä½ ä¸éœ€è¦äº†è§£ç»„ä»¶ç”¨äºå£°æ˜æ–°çŠ¶æ€å˜é‡çš„å…¶ä»– Hookï¼Œä¹Ÿä¸èƒ½é€šè¿‡æ›´æ–°å…¶ä¸­ä¸€ä¸ªæ¥ç ´åå…¶ä»–çš„çŠ¶æ€å˜é‡ã€‚</p>
<p><strong>ç»“è®ºï¼š</strong> âœ… <code>useState()</code>ä¸ä¼šä½¿è‡ªå®šä¹‰ Hook æ˜“ç¢ã€‚</p>
<h3 id="è°ƒè¯•-Debugging"><a href="#è°ƒè¯•-Debugging" class="headerlink" title="è°ƒè¯• Debugging"></a>è°ƒè¯• Debugging</h3><p>é’©å­ä¼šå¾ˆæœ‰ç”¨ï¼Œå› ä¸ºä½ å¯ä»¥ç”¨è¿‡å®ƒ<em>ä¼ é€’</em>å€¼ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useWindowWidth</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [width, setWidth] = useState(<span class="built_in">window</span>.innerWidth);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> width;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useTheme</span>(<span class="params">isMobile</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Comment</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> width = useWindowWidth();</span><br><span class="line">  <span class="keyword">const</span> isMobile = width &lt; MOBILE_VIEWPORT;</span><br><span class="line">  <span class="keyword">const</span> theme = useTheme(isMobile);</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">&#123;theme.comment&#125;</span>&gt;</span>&#123;/* ... */&#125;<span class="tag">&lt;/<span class="name">section</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬çŠ¯é”™äº†å‘¢ï¼Ÿè¯¥å¦‚ä½•è°ƒè¯•ï¼Ÿ</p>
<p>å‡è®¾æˆ‘ä»¬ä»<code>theme.comment</code>è·å¾—çš„ CSS ç±»æ˜¯é”™è¯¯çš„ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•è°ƒè¯•ï¼Ÿæˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶çš„ä¸»ä½“ä¸­è®¾ç½®æ–­ç‚¹æˆ–å‡ ä¸ªæ—¥å¿—è¾“å‡ºã€‚</p>
<p>ä¹Ÿè®¸æˆ‘ä»¬ä¼šçœ‹åˆ°<code>theme</code>é”™è¯¯ä½†æ˜¯<code>width</code>å’Œ<code>isMobile</code>æ˜¯æ­£ç¡®çš„ã€‚è¿™ä¼šå‘Šè¯‰æˆ‘ä»¬é—®é¢˜æ˜¯<code>useTheme()</code>ä¸­çš„ã€‚æˆ–è€…ä¹Ÿè®¸æˆ‘ä»¬ä¼šçœ‹åˆ°<code>width</code>æœ¬èº«å°±æ˜¯é”™çš„ï¼Œé‚£æˆ‘ä»¬å°±åº”è¯¥æŸ¥çœ‹<code>useWindowWidth()</code>ã€‚</p>
<p><strong>å•ç‹¬æŸ¥çœ‹ä¸­é—´å€¼ä¼šå‘Šè¯‰æˆ‘ä»¬é¡¶å±‚çš„é‚£äº› Hook åŒ…å« Bugã€‚</strong>æˆ‘ä»¬ä¸éœ€è¦æŸ¥çœ‹ä»–ä»¬<em>æ‰€æœ‰çš„</em>å®ç°ã€‚</p>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥â€œæ”¾å¤§â€æœ‰ Bug çš„éƒ¨åˆ†å¹¶å°è¯•å¤ç°ã€‚</p>
<p>éšç€è‡ªå®šä¹‰ Hook åµŒå¥—çš„æ·±åº¦å¢åŠ ï¼Œè¿™ä¼šå˜å¾—æ›´åŠ é‡è¦ã€‚æƒ³è±¡æˆ‘ä»¬æœ‰ 3 ä¸ªçº§åˆ«çš„è‡ªå®šä¹‰ Hook åµŒå¥—ï¼Œæ¯ä¸ªçº§åˆ«ä½¿ç”¨ 3 ä¸ªä¸åŒçš„è‡ªå®šä¹‰ Hooksã€‚å¯»æ‰¾<strong>3 å¤„</strong>ä¸æ½œåœ¨æ£€æŸ¥<strong>3 + 3Ã—3 + 3Ã—3Ã—3 = 39 å¤„</strong>ä¹‹é—´çš„<a href="/archives/algorithm/1549245751.html">å·®å¼‚</a>æ˜¯å·¨å¤§çš„ã€‚å¹¸è¿çš„æ˜¯ï¼Œ<code>useState()</code>ä¸èƒ½ç¥å¥‡çš„â€œå½±å“â€å…¶ä»–é’©å­æˆ–ç»„ä»¶ï¼Œå®ƒè¿”å›çš„é”™è¯¯å€¼ä¼šåœ¨å®ƒåé¢ç•™ä¸‹ä¸€æ¡ç—•è¿¹ï¼Œå°±åƒä»»ä½•å˜é‡ä¸€æ ·ã€‚ğŸ›</p>
<p><strong>ç»“è®ºï¼š</strong> âœ… <code>useState()</code>ä¸ä¼šé®æ©æˆ‘ä»¬ä»£ç ä¸­çš„å› æœå…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ç—•è¿¹è¿½è¸ªåˆ° Bugã€‚</p>
<hr>
<h2 id="ä¸åº”ä½¿ç”¨-Hookï¼šuseBailout"><a href="#ä¸åº”ä½¿ç”¨-Hookï¼šuseBailout" class="headerlink" title="ä¸åº”ä½¿ç”¨ Hookï¼šuseBailout()"></a>ä¸åº”ä½¿ç”¨ Hookï¼š<code>useBailout()</code></h2><p>ä½œä¸ºä¼˜åŒ–ï¼Œä½¿ç”¨ Hooks çš„ç»„ä»¶å¯ä»¥é¿å…é‡æ–°æ¸²æŸ“ã€‚</p>
<p>ä¸€ç§æ–¹æ³•æ˜¯å°†æ•´ä¸ªç»„ä»¶å‘¨å›´æ–¹å¼ä¸€ä¸ª<a href="https://reactjs.org/blog/2018/10/23/react-v-16-6.html#reactmemo" target="_blank" rel="noopener"><code>React.memo()</code></a>åŒ…è£…å™¨ã€‚å¦‚æœ props ä¸æˆ‘ä»¬åœ¨ä¸Šä¸€æ¬¡æ¸²æŸ“çš„è¿‡ç¨‹ä¸­çš„ props éå¸¸ç›¸ç­‰ï¼Œä»–å°±ä¼šå¤±å»é‡æ–°æ¸²æŸ“çš„æ•ˆæœï¼Œè¿™å¾ˆç±»ä¼¼<code>PureComponent</code>ç±»ã€‚</p>
<p><code>React.memo()</code>æ¥å—ä¸€ä¸ªç»„ä»¶å¹¶è¿”å›ä¸€ä¸ªç»„ä»¶ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Button</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> React.memo(Button);</span><br></pre></td></tr></table></figure>

<p><strong>ä½†æ˜¯ä¸ºä»€ä¹ˆå®ƒä¸ä»…æ˜¯ä¸ª Hook?</strong></p>
<p>æ— è®ºä½ å°†å®ƒæˆä¸º<code>useShouldComponentUpdate()</code>ï¼Œ<code>usePure()</code>ï¼Œ<code>useSkipRender()</code>æˆ–<code>useBailout()</code>ï¼Œè¿™ä¸ªä½“éªŒå¾€å¾€çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Button</span>(<span class="params">&#123; color &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// âš ï¸ Not a real API</span></span><br><span class="line">  useBailout(<span class="function"><span class="params">prevColor</span> =&gt;</span> prevColor !== color, color);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&#123;</span>"<span class="attr">button-</span>" + <span class="attr">color</span>&#125;&gt;</span>OK<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰ä¸€äº›å˜åŒ–ï¼ˆegï¼šä¸€ä¸ªç®€å•çš„<code>usePure()</code>æ ‡è®°ï¼‰ä½†æ˜¯åœ¨å¹¿æ³›çš„ç¬”åˆ’ä¸­ä»–ä»¬å…·æœ‰ç›¸åŒçš„ç¼ºé™·ã€‚</p>
<h3 id="æ„æˆ-Composition-1"><a href="#æ„æˆ-Composition-1" class="headerlink" title="æ„æˆ Composition"></a>æ„æˆ Composition</h3><p>å‡è®¾æˆ‘ä»¬å°è¯•å°†<code>useBailout()</code>æ”¾åœ¨ä¸¤ä¸ªè‡ªå®šä¹‰ Hooks ä¸­ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useFriendStatus</span>(<span class="params">friendID</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [isOnline, setIsOnline] = useState(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// âš ï¸ Not a real API  useBailout(prevIsOnline =&gt; prevIsOnline !== isOnline, isOnline);</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> handleStatusChange = <span class="function"><span class="params">status</span> =&gt;</span> setIsOnline(status.isOnline);</span><br><span class="line">    ChatAPI.subscribe(friendID, handleStatusChange);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> ChatAPI.unsubscribe(friendID, handleStatusChange);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> isOnline;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useWindowWidth</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [width, setWidth] = useState(<span class="built_in">window</span>.innerWidth);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// âš ï¸ Not a real API  useBailout(prevWidth =&gt; prevWidth !== width, width);</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> handleResize = <span class="function"><span class="params">()</span> =&gt;</span> setWidth(<span class="built_in">window</span>.innerWidth);</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">"resize"</span>, handleResize);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">window</span>.removeEventListener(<span class="string">"resize"</span>, handleResize);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> width;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å¦‚æœä½ åœ¨åŒä¸€ä¸ªç»„ä»¶ä½¿ç”¨å®ƒä»¬ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ChatThread</span>(<span class="params">&#123; friendID, isTyping &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> width = useWindowWidth();</span><br><span class="line">  <span class="keyword">const</span> isOnline = useFriendStatus(friendID);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;ChatLayout width=&#123;width&#125;&gt;</span><br><span class="line">      &lt;FriendStatus isOnline=&#123;isOnline&#125; /&gt;</span><br><span class="line">      &#123;isTyping &amp;&amp; <span class="string">"Typing..."</span>&#125;</span><br><span class="line">    &lt;<span class="regexp">/ChatLayout&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä»€ä¹ˆæ—¶å€™é‡æ–°æ¸²æŸ“ï¼Ÿ</p>
<p>å¦‚æœæ¯ä¸ª<code>useBailout()</code>è°ƒç”¨éƒ½æœ‰æƒè·³è¿‡æ›´æ–°ï¼Œé‚£ä¹ˆæ¥è‡ª<code>useWindowWidth()</code>çš„æ›´æ–°å°†è¢«<code>useFriendStatus()</code>é˜»å¡ï¼Œåä¹‹äº¦ç„¶ã€‚<strong>è¿™äº› Hook ä¼šç›¸äº’ç ´åã€‚</strong></p>
<p>ä½†æ˜¯ï¼Œå¦‚æœ<code>useBailout()</code>å°½åœ¨å•ä¸ªç»„ä»¶å†…çš„<em>æ‰€æœ‰</em>è°ƒç”¨â€œåŒæ„â€é˜»æ­¢æ›´æ–°æ—¶æ‰èƒ½ä½¿ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„<code>ChatThread</code>å°†æ— æ³•æ›´æ–°<code>isTyping</code>prop çš„æ›´æ”¹ã€‚</p>
<p>æ›´ç³Ÿç³•çš„æ˜¯ï¼Œä½¿ç”¨è¿™äº›è¯­ä¹‰<strong>ä»»ä½•æ–°æ·»åŠ åˆ° ChatThread çš„ Hook å¦‚æœæ²¡æœ‰è°ƒç”¨ useBailout()å°†ä¼šæŸå</strong>ã€‚å¦åˆ™ï¼Œä»–ä»¬ä¸èƒ½â€œåå¯¹â€ä½¿ç”¨<code>useWindowWidth()</code>å’Œ <code>useFriendStatus()</code>æ•‘åŠ©ã€‚</p>
<p><strong>ç»“è®ºï¼š</strong> ğŸ”´ <code>useBailout()</code>æ‰“ç ´äº†æ„å»ºæ–¹å¼ï¼Œå°†å…¶æ·»åŠ åˆ° Hook ä¼šç ´åå…¶ä»– Hook çš„çŠ¶æ€æ›´æ–°ã€‚æˆ‘ä»¬å¸Œæœ› API å¯ä»¥å…·æœ‰<a href="https://overreacted.io/optimized-for-change/" target="_blank" rel="noopener">é˜²ç¢æ€§</a>ï¼Œè€Œè¿™ç§è¡Œä¸ºå´èƒŒé“è€Œé©°ã€‚</p>
<h3 id="è°ƒè¯•-Debugging-1"><a href="#è°ƒè¯•-Debugging-1" class="headerlink" title="è°ƒè¯• Debugging"></a>è°ƒè¯• Debugging</h3><p>åƒ<code>useBailout()</code>è¿™æ ·çš„ Hook å¦‚ä½•å½±å“è°ƒè¯•ï¼Ÿ</p>
<p>æˆ‘ä»¬å°†ä½¿ç”¨ç›¸åŒçš„ç¤ºä¾‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ChatThread</span>(<span class="params">&#123; friendID, isTyping &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> width = useWindowWidth();</span><br><span class="line">  <span class="keyword">const</span> isOnline = useFriendStatus(friendID);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;ChatLayout width=&#123;width&#125;&gt;</span><br><span class="line">      &lt;FriendStatus isOnline=&#123;isOnline&#125; /&gt;</span><br><span class="line">      &#123;isTyping &amp;&amp; <span class="string">"Typing..."</span>&#125;</span><br><span class="line">    &lt;<span class="regexp">/ChatLayout&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬æœŸæœ›<code>Typing...</code>æ ‡ç­¾ä¸ä¼šå‡ºç°ï¼Œå³ä¾¿åœ¨ä¸Šå±‚çš„ prop æ­£åœ¨å‘ç”Ÿå˜åŒ–ã€‚æˆ‘ä»¬è¯¥æ€ä¹ˆè°ƒè¯•ï¼Ÿ</p>
<p><strong>é€šå¸¸ï¼Œåœ¨ React ä¸­ä½ è‡ªä¿¡å¯ä»¥é€šè¿‡æŸ¥æ‰¾æ¥ç»™å‡ºç¡®åˆ‡çš„å›ç­”ã€‚</strong>å¦‚æœ<code>ChatThread</code>æ²¡èƒ½å¾—åˆ°ä¸€ä¸ªæ–°çš„<code>isTyping</code>å€¼ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å¼€å‘ˆç°<code>&lt;ChatThread isTyping={myVar} /&gt;</code>çš„ç»„ä»¶å¹¶æ£€æŸ¥<code>myVar</code>ï¼Œä»¥æ­¤ç±»æ¨ã€‚åœ¨å…¶ä¸­ä¸€ä¸ªçº§åˆ«ï¼Œæˆ‘ä»¬è¦ä¹ˆæ‰¾åˆ°ä¸€ä¸ªé”™è¯¯çš„<code>shouldComponentUpdate()</code>æ•‘åŠ©ï¼Œè¦ä¹ˆä¼ é€’ä¸æ­£ç¡®çš„<code>isTyping</code>å€¼ã€‚ä¸€çœ‹é“¾ä¸­çš„æ¯ä¸ªç»„ä»¶é€šå¸¸è¶³ä»¥è¿½å¯»åˆ°é—®é¢˜çš„æ ¹æºã€‚</p>
<p>ä½†æ˜¯å¦‚æœè¿™ä¸ª<code>useBailout()</code>Hook æ˜¯çœŸçš„ï¼Œä½ æ°¸è¿œä¹Ÿä¸ä¼šçŸ¥é“æ›´æ–°è¢«è·³è¿‡çš„åŸå› ï¼ŒçŸ¥é“ä½ æ£€æŸ¥æˆ‘ä»¬çš„<code>ChatThread</code>åŠå…¶æ‰€æœ‰è€…é“¾ä¸­çš„ç»„ä»¶ä½¿ç”¨çš„<em>æ¯ä¸ªè‡ªå®šä¹‰ Hook</em>ï¼ˆçš„æ·±åº¦ï¼‰ã€‚ç”±äºæ¯ä¸ªçˆ¶ç»„ä»¶ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ Hookï¼Œå› æ­¤<a href="/archives/algorithm/1549245751.html">æ‹“å±•</a>éå¸¸ç³Ÿç³•ã€‚</p>
<p>å°±åƒä½ åœ¨æŠ½å±‰é‡Œå¯»æ‰¾ä¸€æŠŠèºä¸åˆ€ä¸€æ ·ï¼Œæ¯ä¸ªæŠ½ç»éƒ½æœ‰ä¸€å †è¾ƒå°çš„æŠ½å±‰æŸœï¼Œä½ ä¸çŸ¥é“å…”å­æ´æœ‰å¤šæ·±ã€‚</p>
<p><strong>ç»“è®ºï¼š</strong> ğŸ”´ <code>useBailout()</code>Hook ä¸ä»…æ‰“ç ´äº†æ„å»ºï¼Œæ›´å¤§å¤§å¢åŠ äº†è°ƒè¯•æ­¥éª¤å’Œæ±‚åŠ©æ‰€éœ€çš„è®¤çŸ¥é—¨æ§›â€”â€”åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå‘ˆæŒ‡æ•°å¼å¢åŠ ã€‚</p>
<hr>
<p>æˆ‘ä»¬åªçœ‹åˆ°äº†ä¸€ä¸ªçœŸæ­£çš„ Hookï¼Œ<code>useState()</code>ï¼Œè¿˜æœ‰ä¸€ä¸ªå…³äº<em>ä¸è¯¥ä½¿ç”¨</em>Hook çš„å¸¸è§„å»ºè®®â€”â€”<code>useBailout()</code>ã€‚æˆ‘ä»¬é€šè¿‡æ„å»ºå’Œè°ƒè¯•çš„æ£±é•œå¯¹ä»–ä»¬è¿›è¡Œäº†æ¯”è¾ƒï¼Œè®¨è®ºäº†å®ƒä»¬ä¸­å·¥ä½œä¸å¦çš„åŸå› ã€‚</p>
<p>è™½ç„¶æ²¡æœ‰<code>memo()</code>å’Œ<code>shouldComponentUpdate()</code>çš„â€œHook ç‰ˆæœ¬â€ï¼Œä½† React<em>ä¼š</em>æä¾›ä¸€ä¸ª Hook è°ƒç”¨<a href="https://reactjs.org/docs/hooks-reference.html#usememo" target="_blank" rel="noopener"><code>useMemo()</code></a>çš„æ–¹æ³•ã€‚å®ƒæœ‰ç±»ä¼¼çš„ç”¨é€”ï¼Œä½†å®ƒè¯­ä¹‰ä¸åŒï¼Œå¹¶ä¸ä¼šé­é‡ä¸Šè¿°é™·é˜±ã€‚</p>
<p><code>useBailout()</code>åªæ˜¯ä¸€ä¸ªä¸è¯¥ä½¿ç”¨ Hook å·¥ä½œçš„ä¾‹å­ï¼Œè¿˜æœ‰å¾ˆå¤šç±»ä¼¼çš„â€”â€”ä¾‹å¦‚ï¼š<code>useProvider()</code>ï¼Œ<code>useCatch()</code>æˆ–<code>useSuspense()</code>ã€‚</p>
<p>ä½ æ˜ç™½ä¸ºä»€ä¹ˆå—ï¼Ÿ</p>
<p><em>ï¼ˆå°å£°ï¼šç»„æˆâ€¦è°ƒè¯•â€¦ï¼‰</em></p>
<p><a href="https://mobile.twitter.com/search?q=https%3A%2F%2Foverreacted.io%2Fwhy-isnt-x-a-hook%2F" target="_blank" rel="noopener">Discuss on Twitter</a> â€¢ <a href="https://github.com/gaearon/overreacted.io/edit/master/src/pages/why-isnt-x-a-hook/index.md" target="_blank" rel="noopener">Edit on GitHub</a></p>
<p>åŸæ–‡é“¾æ¥ï¼š <a href="https://overreacted.io/why-isnt-x-a-hook/" target="_blank" rel="noopener">Why Isnâ€™t X a Hook?</a></p>

      </div>
      <div class="post-copyright">
    <p class="copyright-item">
      <span>åŸæ–‡ä½œè€…: </span>
      <a href="https://xinpuchen.github.io">Xinpu</a>
    </p>
    <p class="copyright-item">
      <span>åŸæ–‡é“¾æ¥: </span>
      <a href="https://xinpuchen.github.io/Why-Isn%E2%80%99t-X-a-Hook/">https://xinpuchen.github.io/Why-Isn%E2%80%99t-X-a-Hook/</a>
    </p>
    <p class="copyright-item">
      <span>è®¸å¯åè®®: </span><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 4.0 å›½é™…è®¸å¯åè®®</a>
    </p>
  </div>
      <footer class="post-footer">
        <div class="post-tags">
            <a href="/tags/React/">React</a>
            <a href="/tags/Hooks/">Hooks</a>
            </div>
        
        <nav class="post-nav"><a class="prev" href="/overrides-mode/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">è¦†ç›–æ¨¡å¼-æé«˜ React ç»„ä»¶çš„å¤ç”¨ç‡</span>
        <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
      </a>
    <a class="next" href="/improve-react-performance-using-lazy-loading-and-suspense/">
        <span class="next-text nav-default">ä½¿ç”¨æ‡’åŠ è½½å’ŒSuspenseæé«˜Reactæ€§èƒ½</span>
        <span class="prev-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></footer>
    </article></div><div class="comments" id="comments"><div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:xinpuchen@foxmail.com" class="iconfont icon-email" title="email"></a>
        <a href="https://www.linkedin.com/in/xinpuchen" target="_blank" rel="noopener" class="iconfont icon-linkedin" title="linkedin"></a>
        <a href="https://github.com/xinpuchen" target="_blank" rel="noopener" class="iconfont icon-github" title="github"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even" target="_blank" rel="noopener">Even</a>
  </span>

  <span class="copyright-year">&copy;2018 - 2020<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Xinpu</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'https://xinpuchen.github.io/Why-Isn%E2%80%99t-X-a-Hook/';
        this.page.identifier = 'Why-Isnâ€™t-X-a-Hook/';
        this.page.title = 'ä¸ºä»€ä¹ˆé€‰æ‹©Hookè€Œéâ€¦â€¦?';
    };
    (function() {
    var d = document, s = d.createElement('script');

    s.src = '//xinpuchen.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();  
  </script>
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>


<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"/>


<script src="//cdn.jsdelivr.net/npm/js-md5@0.7.3/src/md5.min.js"></script>

<script>
  var gitalk = new Gitalk({
    clientID: 'GitHub Application Client ID',
    clientSecret: 'GitHub Application Client Secret',
    repo: 'GitHub repo',
    owner: 'GitHub repo owner',
    admin: ['GitHub repo owner and collaborators, only these guys can initialize github issues'],
    id: md5(location.pathname),
    
      language: 'zh-CN',
    
    distractionFreeMode: 'true'
  });
  gitalk.render('gitalk-container');
</script><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
